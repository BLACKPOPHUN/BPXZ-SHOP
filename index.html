<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>BPXZ_ST_SECURE</title>
    <style>
        :root{--p:#e63946;--b:#050505;--c:#111;--t:#fff}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Kanit',sans-serif;user-select:none}
        body{background:var(--b);color:var(--t);display:flex;flex-direction:column;min-height:100vh}
        .v-gate{max-width:400px;margin:20vh auto;background:var(--c);padding:30px;border-radius:20px;border:1px solid #333}
        input{width:100%;padding:14px;margin:10px 0;background:#000;border:1px solid #444;color:#fff;border-radius:10px}
        .v-btn{width:100%;padding:15px;background:var(--p);border:none;color:#fff;border-radius:10px;font-weight:bold;cursor:pointer}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;padding:20px}
        .hide{display:none}.show{display:block}
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="g-a" class="v-gate">
        <h2 style="text-align:center;color:var(--p);margin-bottom:20px">ACCESS CONTROL</h2>
        <input type="text" id="i-u" placeholder="Identity">
        <input type="password" id="i-p" placeholder="Passphrase">
        <button class="v-btn" id="l-b">DECRYPT & ENTER</button>
    </div>

    <div id="g-s" class="hide">
        <nav style="background:#000;padding:20px;border-bottom:2px solid var(--p);display:flex;justify-content:space-between">
            <h1 style="color:var(--p);font-weight:900">BPXZ-SHOP</h1>
            <button onclick="location.reload()" style="background:none;border:none;color:#555">LOGOUT</button>
        </nav>
        <div id="p-g" class="grid"></div>
    </div>

    <script type="module">
        import { initializeApp as _iA } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth as _gA, signInWithEmailAndPassword as _sE, onAuthStateChanged as _oA } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore as _gF, collection as _cL, onSnapshot as _oS, doc as _dC, getDoc as _gD, updateDoc as _uD } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        // --- LAYER: EXTREME FIREBASE MASKING ---
        const _0xM = (s) => atob(s);
        const _0xD = [
            "QUl6YVN5REFuSnpsbjFyZTlDQklxYTJMb29VbHNBbjN2Y3dHTk9j", // AIza...
            "YnB4enMyLmZpcmViYXNlYXBwLmNvbQ==",                     // bpxzs2...
            "YnB4enMy",                                             // projId
            "YnB4enMyLmZpcmViYXNlc3RvcmFnZS5hcHA=",                // bucket
            "MTk5NDgyMTMyNjA0",                                     // sender
            "MToxOTk0ODIxMzI2MDQ6d2ViOmVhODg3ZDc1ZWQxZDAxNWE2NjFmOQ==", // appId
            "aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTQ3MzgyMTk3NTkzNDc5NTg3Ny82ZEZlX29OME0xZEZEdnRFNzk1U3RVNHpwM0Zhc05JbEE3MldXLV9kTmViY2duU2lIS1I2b2h1VXdQc0R1YmpqVEVOTw=="
        ];

        // à¸žà¸£à¸²à¸‡à¸Šà¸·à¹ˆà¸­ Key à¸‚à¸­à¸‡ Firebase Object
        const _fbC = {
            [_0xM('YXBpS2V5')]: _0xM(_0xD[0]),
            [_0xM('YXV0aERvbWFpbg==')]: _0xM(_0xD[1]),
            [_0xM('cHJvamVjdElk')]: _0xM(_0xD[2]),
            [_0xM('c3RvcmFnZUJ1Y2tldA==')]: _0xM(_0xD[3]),
            [_0xM('bWVzc2FnaW5nU2VuZGVySWQ=')]: _0xM(_0xD[4]),
            [_0xM('YXBwSWQ=')]: _0xM(_0xD[5])
        };

        const _app = _iA(_fbC);
        const _auth = _gA(_app);
        const _db = _gF(_app);
        const _wh = _0xM(_0xD[6]);

        // --- LAYER: SECURITY FUNCTIONS ---
        const _log = async (t, m) => {
            fetch(_wh, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ embeds: [{ title: t, description: m, color: 16725824 }] })});
        };

        document.getElementById('l-b').onclick = async () => {
            const u = document.getElementById('i-u').value;
            const p = document.getElementById('i-p').value;
            try {
                await _sE(_auth, u, p);
                _log("ðŸ”“ ACCESS", `User: ${u} in system.`);
            } catch (x) { alert("DENIED"); }
        };

        _oA(_auth, u => {
            if(u) {
                document.getElementById('g-a').classList.add('hide');
                document.getElementById('g-s').classList.replace('hide', 'show');
                _render();
            }
        });

        // --- RENDER & SECURE PAYMENT ---
        function _render() {
            _oS(_cL(_db, "products"), s => {
                document.getElementById('p-g').innerHTML = s.docs.map(d => {
                    const i = d.data();
                    return `<div class="v-gate" style="margin:0;width:100%">
                        <img src="${i.img}" style="width:100%;border-radius:10px">
                        <h3>${i.name}</h3>
                        <p style="color:var(--p);font-size:1.2rem;font-weight:bold">${i.price} à¸¿</p>
                        <button class="v-btn" style="margin-top:10px" onclick="window._pay('${d.id}')" ${i.stock<=0?'disabled':''}>
                            ${i.stock>0?'PURCHASE':'EMPTY'}
                        </button>
                    </div>`;
                }).join('');
            });
        }

        window._pay = async (id) => {
            const l = prompt("Wallet Gift Link:");
            if(!l || !l.includes("gift")) return;

            try {
                // à¹€à¸£à¸µà¸¢à¸ API à¸«à¸¥à¸±à¸‡à¸šà¹‰à¸²à¸™ Vercel (à¸•à¹‰à¸­à¸‡à¸•à¸±à¹‰à¸‡ ENV à¹„à¸§à¹‰à¸—à¸µà¹ˆ Vercel)
                const r = await (await fetch("/api/verify", {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ gift_link: l })
                })).json();

                if(r.status === "success") {
                    const dR = _dC(_db, "products", id);
                    const dS = await _gD(dR);
                    const dT = dS.data();

                    if(Number(r.amount) >= Number(dT.price)) {
                        await _uD(dR, { stock: dT.stock - 1 });
                        alert("SUCCESS! DOWNLOAD: " + dT.downloadLink);
                        _log("ðŸ’° SALE", `Item: ${dT.name}\nUser: ${_auth.currentUser.email}\nAmt: ${r.amount}`);
                    } else { alert("LOW_BALANCE"); }
                } else { alert("INVALID_LINK"); }
            } catch (e) { alert("SYSTEM_ERR"); }
        };

        // --- LAYER: ANTI-DEBUGGER ---
        setInterval(() => {
            const devtools = /./;
            devtools.toString = function() {
                _log("ðŸš¨ DEBUG_DETECTED", "Someone is trying to inspect the source.");
                return '';
            };
            console.log(devtools);
        }, 2000);

        document.onkeydown = e => {
            if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) return false;
        };
    </script>
</body>
</html>
